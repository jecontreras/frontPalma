<div class="header-section d-flex justify-content-between align-items-center">
  <h2 class="mat-headline">üööüí® METODO {{ data.metoD }}</h2>
  <button mat-mini-fab color="warn" (click)="mostrarAlerta()">
    <mat-icon>close</mat-icon>
  </button>
</div>

<mat-dialog-content class="mat-typography">

  <!-- Secci√≥n Env√≠o -->
  <div *ngIf="!data.id">
    <h1 class="text-center">Datos de Env√≠o</h1>
    <p class="text-center warning-text">
      TU COMPRA ES UN COMPROMISO. Si no est√°s seguro de comprar o recibir el producto, evita hacer el pedido.
      No aceptarlo generar√° un costo por devoluci√≥n.
    </p>
    <mat-divider></mat-divider>

    <form #dataForm="ngForm" novalidate class="form-section">

      <!-- Nombre -->
      <div class="form-group col-12 col-sm-12" [ngClass]="{ 'has-error': isInvalid(dataForm, 'nombre') }">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ getCampo('nombre')?.label || 'Nombre y Apellido' }}</mat-label>
          <mat-icon matPrefix>account_circle</mat-icon>
          <input matInput type="text" [(ngModel)]="data.nombre" name="nombre"
                [placeholder]="getCampo('nombre')?.placeholder || 'Nombre y Apellido'"
                required #nombre="ngModel" (change)="validadorInput()">
          <mat-error *ngIf="nombre.invalid && nombre.touched">
            {{ getCampo('nombre')?.mensajeError || 'Este campo es obligatorio.' }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Pa√≠s + Tel√©fono -->
      <div class="form-row phone-row col-sm-12">
        <mat-form-field appearance="outline" class="country-select">
          <mat-label>{{ getCampo('pais')?.label || 'Pa√≠s' }}</mat-label>
          <mat-select [(ngModel)]="data.ven_indicativo_cliente" name="ven_indicativo_cliente" required>
            <mat-option *ngFor="let country of americanCountries" [value]="country">
              <img [src]="country.flag" class="flag-icon" /> +{{ country.dialCode }} - {{ country.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="phone-input">
          <mat-label>{{ getCampo('telefono')?.label || 'N√∫mero de Tel√©fono' }}</mat-label>
          <mat-icon matPrefix>phone</mat-icon>
          <input matInput type="number" [(ngModel)]="data.telefono" name="telefono"
                [placeholder]="getCampo('telefono')?.placeholder || 'N√∫mero de Tel√©fono'"
                required #telefono="ngModel" (change)="validadorInput()">
          <mat-error *ngIf="telefono.invalid && telefono.touched">
            {{ getCampo('telefono')?.mensajeError || 'Este campo es obligatorio.' }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Direcci√≥n, Departamento, Ciudad -->
      <div class="form-grid" style="width: 100%;">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ getCampo('direccion')?.label || 'Direcci√≥n de Entrega' }}</mat-label>
          <mat-icon matPrefix>home</mat-icon>
          <input matInput type="text" [(ngModel)]="data.direccion" name="direccion"
                [placeholder]="getCampo('direccion')?.placeholder || 'Direcci√≥n de Entrega'"
                required #direccion="ngModel" (change)="validadorInput()">
          <mat-error *ngIf="direccion.invalid && direccion.touched">
            {{ getCampo('direccion')?.mensajeError || 'Este campo es obligatorio.' }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ getCampo('departament')?.label || 'Departamento' }}</mat-label>
          <mat-icon matPrefix>straighten</mat-icon>
          <mat-select [(ngModel)]="data.departament" name="departament" required #departament="ngModel"
                      (selectionChange)="validadorInput(); handleProcessDepartament();">
            <mat-option *ngFor="let keyOf of listDepartament" [value]="keyOf.id">
              {{ keyOf.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>{{ getCampo('ciudad')?.label || 'Ciudad o Municipio' }}</mat-label>
          <mat-icon matPrefix>straighten</mat-icon>
          <mat-select [(ngModel)]="data.ciudad" name="ciudad" required #ciudad="ngModel"
                      (selectionChange)="validadorInput()">
            <mat-option *ngFor="let keyOf of listCiudad" [value]="keyOf.name">
              {{ keyOf.name }}
            </mat-option>
          </mat-select>
          <mat-spinner *ngIf="loadingCity" diameter="20"></mat-spinner>
          <mat-error *ngIf="ciudad.invalid && ciudad.touched">
            {{ getCampo('ciudad')?.mensajeError || 'Este campo es obligatorio.' }}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Barrio -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ getCampo('barrio')?.label || 'Barrio o Localidad' }}</mat-label>
        <mat-icon matPrefix>map</mat-icon>
        <input matInput type="text" [(ngModel)]="data.barrio" name="barrio"
              [placeholder]="getCampo('barrio')?.placeholder || 'Barrio o Localidad'"
              required #barrio="ngModel" (change)="validadorInput()">
        <mat-error *ngIf="barrio.invalid && barrio.touched">
          {{ getCampo('barrio')?.mensajeError || 'Este campo es obligatorio.' }}
        </mat-error>
      </mat-form-field>

      <!-- Checkboxes -->
      <div class="checkbox-group">
        <mat-checkbox [(ngModel)]="data.pedidoCheck" name="pedidoCheck" required>
          {{ getCampo('pedidoCheck')?.label || 'Si, acepto recibir el pedido.' }}
        </mat-checkbox>
        <mat-checkbox [(ngModel)]="data.terminoCheck" name="terminoCheck" required>
          {{ getCampo('terminoCheck')?.label || 'Acepte nuestros t√©rminos y condiciones.' }}
        </mat-checkbox>
      </div>

    </form>


    <!-- Lista de Promociones -->
    <div class="promotion-list-section mat-elevation-z2">
      <div class="list-header d-flex justify-content-between align-items-center">
        <h3><strong>Lista de Selecci√≥n promoci√≥n</strong></h3>
        <button mat-mini-fab color="primary" (click)="handleCantidad(true)">
          <mat-icon>add_box</mat-icon>
        </button>
      </div>

      <mat-list>
        <mat-list-item *ngFor="let item of listCantidad" class="list-item-container">
          <div class="row" style="width: 100%;">

            <!-- Color -->
            <div class="form-group col-5" *ngIf="datas.listColor.length === 0">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Color</mat-label>
                <mat-icon matPrefix>palette</mat-icon>
                <input matInput type="text" [(ngModel)]="item.color" name="item.color" required>
              </mat-form-field>
            </div>

            <div class="form-group col-5" *ngIf="datas.listColor.length">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Color</mat-label>
                <mat-select [(ngModel)]="item.color" name="item.color" (selectionChange)="handlePhoto(item)">
                  <mat-option *ngFor="let keyOf of item.listColor" [value]="keyOf.talla">
                    {{ keyOf.talla }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Talla -->
            <div class="form-group col-5" *ngIf="data.talla !== 'Unica' && item.ListTalla.length === 0">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Talla</mat-label>
                <input matInput type="text" [(ngModel)]="item.talla" name="item.talla" required>
              </mat-form-field>
            </div>

            <div class="form-group col-5" *ngIf="data.talla !== 'Unica' && item.ListTalla.length">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Talla</mat-label>
                <mat-select [(ngModel)]="item.talla" name="item.talla">
                  <mat-option *ngFor="let keyOf of item.ListTalla" [value]="keyOf.tal_descripcion">
                    {{ keyOf.tal_descripcion }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="form-group col-2">
                <button mat-mini-fab color="warn" (click)="handleDrop( item )">
                    <mat-icon>delete</mat-icon>
                </button>
            </div>

          </div>
        </mat-list-item>
      </mat-list>
    </div>

    <!-- Total de Compra -->
    <div class="total-summary">
      <div class="row-section"><span>Subtotal</span><strong>{{ _tools.monedaChange2(3, 2, this.data.costo1 || 0) }}</strong></div>
      <div class="row-section"><span>Cantidad</span><strong>{{ data.cantidadAd1 || 1 }}</strong></div>

      <div *ngIf="data.descuento" class="row-section">
        <span>Descuentos</span><strong>{{ _tools.monedaChange2(3, 2, (this.data.descuento) || 0) }}</strong>
      </div>

      <div *ngIf="data.metoD !== 'casa'" class="row-section">
        <span>Servicio pago anticipado</span><strong>-{{ _tools.monedaChange2(3, 2, (datas.pro_uni_compra || 20000) || 0) }}</strong>
      </div>

      <div class="row-section">
        <span>Env√≠o</span>
        <strong *ngIf="!data.pro_vendedor">
          <mat-radio-group [(ngModel)]="data.envioT" (change)="suma()">
            <mat-radio-button value="gratis">Gratis</mat-radio-button>
            <mat-radio-button value="priorida">$5.000 Prioritario</mat-radio-button>
          </mat-radio-group>
        </strong>
        <strong *ngIf="data.pro_vendedor">
          {{ _formato.monedaChange(3, 2, data.pro_vendedor || 0) }}
        </strong>
      </div>

      <div class="row-section total"><span>Total</span><strong>{{ _tools.monedaChange2(3,2,(this.data.costo + data.pro_vendedor) || 0) }}</strong></div>
    </div>
  </div>

  <!-- Venta ya realizada -->
  <div *ngIf="data.id" class="text-center">
    <h3>Chatear con un asesor sobre la venta realizada</h3>
    <img src="./assets/icons/whatsapp.png" class="chat-image" (click)="mensajeWhat()">
  </div>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-raised-button color="primary" (click)="finalizando()" *ngIf="!data.id" [disabled]="disabled" class="confirm-button"
        [ngStyle]="{ 'background-color': config.boton.color, 'color': '#fff' }">
          {{ config.boton.texto }}
  </button>
</mat-dialog-actions>
