<mat-card class="estadisticas-container mat-elevation-z4">
  <mat-card-title class="titulo-panel">ðŸ“Š Panel de EstadÃ­sticas</mat-card-title>

  <!-- FILTROS: Rango de fechas + Empresa (si aplica) -->
  <div class="filtros">
    <mat-form-field appearance="outline">
      <mat-label>Fecha inicio</mat-label>
      <input matInput [matDatepicker]="pickerInicio" placeholder="Selecciona fecha" [(ngModel)]="fechaInicio">
      <mat-datepicker-toggle matSuffix [for]="pickerInicio"></mat-datepicker-toggle>
      <mat-datepicker #pickerInicio></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Fecha fin</mat-label>
      <input matInput [matDatepicker]="pickerFin" placeholder="Selecciona fecha" [(ngModel)]="fechaFin">
      <mat-datepicker-toggle matSuffix [for]="pickerFin"></mat-datepicker-toggle>
      <mat-datepicker #pickerFin></mat-datepicker>
    </mat-form-field>


    <button mat-raised-button color="primary" (click)="filtrar()">Filtrar</button>
    <button mat-button (click)="resetFiltro()">Limpiar</button>
  </div>

  <!-- KPIs -->
  <div class="kpi-container">
    <mat-card class="kpi-box" *ngFor="let kpi of kpiList" [ngStyle]="{ 'background-color': kpi.color }">
      <div class="kpi-title">{{ kpi.titulo }}</div>
      <div class="kpi-value">{{ kpi.valor }}</div>
    </mat-card>
  </div>

  <!-- Graficas -->
  <div class="graficas">
    <div class="grafica-box">
      <h3>ðŸ“ˆ Productos MÃ¡s Vendidos</h3>
      <canvas baseChart
              [datasets]="prodChartData"
              [labels]="prodChartLabels"
              [options]="barOptions"
              [chartType]="'bar'">
      </canvas>
    </div>

    <div class="grafica-box">
      <h3>ðŸ“¦ Estados de Ventas</h3>
      <canvas baseChart
              [data]="estadoPieData"
              [labels]="estadoPieLabels"
              [options]="pieOptions"
              [chartType]="'pie'">
      </canvas>
    </div>

    <div class="grafica-box fullwidth">
      <h3>ðŸšš Transportadoras</h3>
      <canvas baseChart
              [datasets]="transChartData"
              [labels]="transChartLabels"
              [options]="barOptions"
              [chartType]="'bar'">
      </canvas>
    </div>
  </div>

  <!-- Tabla de ventas filtradas -->
  <mat-card class="tabla-card">
    <mat-card-title>Ventas (filtradas)</mat-card-title>
    <div class="table-wrap">
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">

        <ng-container matColumnDef="id"><th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th><td mat-cell *matCellDef="let e"> {{e.id}} </td></ng-container>

        <ng-container matColumnDef="fecha"><th mat-header-cell *matHeaderCellDef mat-sort-header> Fecha </th><td mat-cell *matCellDef="let e"> {{e.ven_fecha_venta}} </td></ng-container>

        <ng-container matColumnDef="cliente"><th mat-header-cell *matHeaderCellDef> Cliente </th><td mat-cell *matCellDef="let e"> {{e.ven_nombre_cliente}} </td></ng-container>

        <ng-container matColumnDef="telefono"><th mat-header-cell *matHeaderCellDef> TelÃ©fono </th><td mat-cell *matCellDef="let e"> {{e.ven_telefono_cliente}} </td></ng-container>

        <ng-container matColumnDef="estado"><th mat-header-cell *matHeaderCellDef> Estado </th><td mat-cell *matCellDef="let e"> {{mapEstado(e.ven_estado)}} </td></ng-container>

        <ng-container matColumnDef="transport"><th mat-header-cell *matHeaderCellDef> Transportadora </th><td mat-cell *matCellDef="let e"> {{e.transport || '-' }} </td></ng-container>

        <ng-container matColumnDef="total"><th mat-header-cell *matHeaderCellDef mat-sort-header> Total </th><td mat-cell *matCellDef="let e"> {{e.ven_total | currency:'COP':'symbol' }} </td></ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <mat-paginator [length]="totalRecords" [pageSize]="10" [pageSizeOptions]="[5,10,25]" (page)="pageChange($event)"></mat-paginator>
    </div>
  </mat-card>
</mat-card>
